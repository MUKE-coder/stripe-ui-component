{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "stripe-ui-component",
  "title": "Stripe UI Component",
  "description": "A complete Stripe checkout solution for Next.js with Payment Element, order management, product grid, and checkout flow. Built with Stripe, Prisma, Zustand, and shadcn/ui.",
  "dependencies": [
    "stripe",
    "@stripe/stripe-js",
    "@stripe/react-stripe-js"
  ],
  "registryDependencies": [
    "button",
    "card",
    "input",
    "label",
    "badge",
    "table",
    "separator",
    "skeleton"
  ],
  "files": [
    {
      "path": "components/stripe/stripe-provider.tsx",
      "content": "\"use client\";\n\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\n\nconst stripePromise = loadStripe(\n  process.env.NEXT_PUBLIC_STRIPE_PUBLIC_KEY!\n);\n\ninterface StripeProviderProps {\n  clientSecret: string;\n  children: React.ReactNode;\n}\n\nexport function StripeProvider({ clientSecret, children }: StripeProviderProps) {\n  return (\n    <Elements\n      stripe={stripePromise}\n      options={{\n        clientSecret,\n        appearance: {\n          theme: \"stripe\",\n          variables: {\n            colorPrimary: \"#6366f1\",\n            borderRadius: \"8px\",\n          },\n        },\n      }}\n    >\n      {children}\n    </Elements>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/checkout-form.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport {\n  PaymentElement,\n  useStripe,\n  useElements,\n} from \"@stripe/react-stripe-js\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2 } from \"lucide-react\";\n\ninterface CheckoutFormProps {\n  totalAmount: number;\n  orderId: string;\n}\n\nexport function CheckoutForm({ totalAmount, orderId }: CheckoutFormProps) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [errorMessage, setErrorMessage] = useState<string>(\"\");\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessing(true);\n    setErrorMessage(\"\");\n\n    const { error } = await stripe.confirmPayment({\n      elements,\n      confirmParams: {\n        return_url: `${window.location.origin}/order-confirmation?order_id=${orderId}`,\n      },\n    });\n\n    // This will only be reached if there's an immediate error\n    // (e.g., card declined). Otherwise, the customer is redirected.\n    if (error) {\n      setErrorMessage(error.message || \"An unexpected error occurred.\");\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div>\n        <h3 className=\"mb-4 text-lg font-semibold\">Payment Information</h3>\n        <PaymentElement\n          options={{\n            layout: \"tabs\",\n          }}\n        />\n      </div>\n\n      {errorMessage && (\n        <div className=\"rounded-md bg-destructive/10 p-3 text-sm text-destructive\">\n          {errorMessage}\n        </div>\n      )}\n\n      <Button\n        type=\"submit\"\n        disabled={!stripe || isProcessing}\n        className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n        size=\"lg\"\n      >\n        {isProcessing ? (\n          <>\n            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n            Processing...\n          </>\n        ) : (\n          `Confirm Payment $${totalAmount.toFixed(2)}`\n        )}\n      </Button>\n    </form>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/checkout-page.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useCartStore } from \"@/components/zustand-cart\";\nimport { AddressForm, type ShippingAddress } from \"./address-form\";\nimport { OrderSummary } from \"./order-summary\";\nimport { CheckoutForm } from \"./checkout-form\";\nimport { StripeProvider } from \"./stripe-provider\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, Loader2 } from \"lucide-react\";\nimport Link from \"next/link\";\n\nexport function CheckoutPage() {\n  const router = useRouter();\n  const { items, getCartTotalPrice } = useCartStore();\n  const [clientSecret, setClientSecret] = useState<string>(\"\");\n  const [orderId, setOrderId] = useState<string>(\"\");\n  const [isCreatingIntent, setIsCreatingIntent] = useState(false);\n  const [error, setError] = useState<string>(\"\");\n  const [address, setAddress] = useState<ShippingAddress>({\n    fullName: \"\",\n    addressLine1: \"\",\n    addressLine2: \"\",\n    city: \"\",\n    state: \"\",\n    postalCode: \"\",\n    country: \"\",\n  });\n\n  const totalPrice = getCartTotalPrice();\n  const deliveryFee = items.length > 0 ? 9.99 : 0;\n  const tax = totalPrice * 0.05;\n  const orderTotal = totalPrice + deliveryFee + tax;\n\n  const isAddressValid =\n    address.fullName.trim() !== \"\" &&\n    address.addressLine1.trim() !== \"\" &&\n    address.city.trim() !== \"\" &&\n    address.state.trim() !== \"\" &&\n    address.postalCode.trim() !== \"\" &&\n    address.country.trim() !== \"\";\n\n  const handleProceedToPayment = async () => {\n    if (!isAddressValid) {\n      setError(\"Please fill in all required address fields.\");\n      return;\n    }\n\n    if (items.length === 0) {\n      setError(\"Your cart is empty.\");\n      return;\n    }\n\n    setIsCreatingIntent(true);\n    setError(\"\");\n\n    try {\n      const response = await fetch(\"/api/stripe/create-payment-intent\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          items: items.map((item) => ({\n            productId: item.id,\n            quantity: item.quantity,\n            price: item.price,\n            name: item.name,\n            image: item.image,\n          })),\n          shippingAddress: address,\n          deliveryFee,\n          tax,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to create payment intent\");\n      }\n\n      setClientSecret(data.clientSecret);\n      setOrderId(data.orderId);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Something went wrong\");\n    } finally {\n      setIsCreatingIntent(false);\n    }\n  };\n\n  if (items.length === 0 && !clientSecret) {\n    return (\n      <div className=\"flex min-h-[60vh] flex-col items-center justify-center gap-4\">\n        <h2 className=\"text-2xl font-semibold\">Your cart is empty</h2>\n        <p className=\"text-muted-foreground\">\n          Add some products before checking out.\n        </p>\n        <Button asChild>\n          <Link href=\"/products\">Browse Products</Link>\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"mx-auto max-w-6xl px-4 py-8\">\n      <div className=\"mb-6\">\n        <Button variant=\"ghost\" asChild>\n          <Link href=\"/products\">\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            Back to Products\n          </Link>\n        </Button>\n      </div>\n\n      <h1 className=\"mb-8 text-3xl font-bold\">Checkout</h1>\n\n      <div className=\"grid gap-8 lg:grid-cols-[1fr_400px]\">\n        {/* Left Column: Address + Payment */}\n        <div className=\"space-y-6\">\n          <div className=\"rounded-lg border bg-card p-6\">\n            <AddressForm address={address} onChange={setAddress} />\n          </div>\n\n          {clientSecret ? (\n            <div className=\"rounded-lg border bg-card p-6\">\n              <StripeProvider clientSecret={clientSecret}>\n                <CheckoutForm totalAmount={orderTotal} orderId={orderId} />\n              </StripeProvider>\n            </div>\n          ) : (\n            <div className=\"rounded-lg border bg-card p-6\">\n              <h3 className=\"mb-4 text-lg font-semibold\">Payment</h3>\n              <p className=\"mb-4 text-sm text-muted-foreground\">\n                Fill in your shipping address above, then proceed to payment.\n              </p>\n\n              {error && (\n                <div className=\"mb-4 rounded-md bg-destructive/10 p-3 text-sm text-destructive\">\n                  <p>{error}</p>\n                  {error.includes(\"products not found\") && (\n                    <p className=\"mt-2 text-xs\">\n                      Your cart may contain outdated items. Please{\" \"}\n                      <button\n                        type=\"button\"\n                        className=\"underline font-medium\"\n                        onClick={() => {\n                          useCartStore.getState().clearCart();\n                          setError(\"\");\n                        }}\n                      >\n                        clear your cart\n                      </button>{\" \"}\n                      and add products from the{\" \"}\n                      <Link href=\"/products\" className=\"underline font-medium\">\n                        products page\n                      </Link>\n                      .\n                    </p>\n                  )}\n                </div>\n              )}\n\n              <Button\n                onClick={handleProceedToPayment}\n                disabled={!isAddressValid || isCreatingIntent}\n                className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n                size=\"lg\"\n              >\n                {isCreatingIntent ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Preparing Payment...\n                  </>\n                ) : (\n                  \"Proceed to Payment\"\n                )}\n              </Button>\n            </div>\n          )}\n        </div>\n\n        {/* Right Column: Order Summary */}\n        <div className=\"lg:sticky lg:top-8 lg:self-start\">\n          <OrderSummary />\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/address-form.tsx",
      "content": "\"use client\";\n\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\n\nexport interface ShippingAddress {\n  fullName: string;\n  addressLine1: string;\n  addressLine2: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n}\n\ninterface AddressFormProps {\n  address: ShippingAddress;\n  onChange: (address: ShippingAddress) => void;\n}\n\nexport function AddressForm({ address, onChange }: AddressFormProps) {\n  const handleChange = (field: keyof ShippingAddress, value: string) => {\n    onChange({ ...address, [field]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <h3 className=\"text-lg font-semibold\">Shipping Address</h3>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"fullName\">Full Name</Label>\n        <Input\n          id=\"fullName\"\n          placeholder=\"John Doe\"\n          value={address.fullName}\n          onChange={(e) => handleChange(\"fullName\", e.target.value)}\n          required\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"addressLine1\">Address Line 1</Label>\n        <Input\n          id=\"addressLine1\"\n          placeholder=\"123 Main Street\"\n          value={address.addressLine1}\n          onChange={(e) => handleChange(\"addressLine1\", e.target.value)}\n          required\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"addressLine2\">Address Line 2 (Optional)</Label>\n        <Input\n          id=\"addressLine2\"\n          placeholder=\"Apt 4B\"\n          value={address.addressLine2}\n          onChange={(e) => handleChange(\"addressLine2\", e.target.value)}\n        />\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"city\">City</Label>\n          <Input\n            id=\"city\"\n            placeholder=\"New York\"\n            value={address.city}\n            onChange={(e) => handleChange(\"city\", e.target.value)}\n            required\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"state\">State / Province</Label>\n          <Input\n            id=\"state\"\n            placeholder=\"NY\"\n            value={address.state}\n            onChange={(e) => handleChange(\"state\", e.target.value)}\n            required\n          />\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"postalCode\">Postal Code</Label>\n          <Input\n            id=\"postalCode\"\n            placeholder=\"10001\"\n            value={address.postalCode}\n            onChange={(e) => handleChange(\"postalCode\", e.target.value)}\n            required\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"country\">Country</Label>\n          <Input\n            id=\"country\"\n            placeholder=\"United States\"\n            value={address.country}\n            onChange={(e) => handleChange(\"country\", e.target.value)}\n            required\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/order-summary.tsx",
      "content": "\"use client\";\n\nimport Image from \"next/image\";\nimport { Trash2 } from \"lucide-react\";\nimport { useCartStore } from \"@/components/zustand-cart\";\nimport { Button } from \"@/components/ui/button\";\n\nexport function OrderSummary() {\n  const { items, removeFromCart, getCartTotalPrice } = useCartStore();\n  const totalPrice = getCartTotalPrice();\n  const deliveryFee = items.length > 0 ? 9.99 : 0;\n  const tax = totalPrice * 0.05;\n  const orderTotal = totalPrice + deliveryFee + tax;\n\n  return (\n    <div className=\"rounded-lg border bg-card p-6\">\n      <h3 className=\"mb-4 text-lg font-semibold\">Order Summary</h3>\n\n      {items.length === 0 ? (\n        <p className=\"text-sm text-muted-foreground\">Your cart is empty</p>\n      ) : (\n        <>\n          <div className=\"space-y-3\">\n            {items.map((item) => (\n              <div key={item.id} className=\"flex items-center gap-3\">\n                <div className=\"relative h-12 w-12 flex-shrink-0 overflow-hidden rounded-md\">\n                  <Image\n                    src={item.image}\n                    alt={item.name}\n                    fill\n                    className=\"object-cover\"\n                    sizes=\"48px\"\n                  />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium truncate\">{item.name}</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    x{item.quantity}\n                  </p>\n                </div>\n                <p className=\"text-sm font-medium\">\n                  ${(item.price * item.quantity).toFixed(2)}\n                </p>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8 text-muted-foreground hover:text-destructive\"\n                  onClick={() => removeFromCart(item.id)}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            ))}\n          </div>\n\n          <div className=\"mt-4 space-y-2 border-t pt-4\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-muted-foreground\">Subtotal</span>\n              <span>${totalPrice.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-muted-foreground\">Delivery</span>\n              <span>${deliveryFee.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-muted-foreground\">Tax (5%)</span>\n              <span>${tax.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between border-t pt-2 font-semibold\">\n              <span>Order Total</span>\n              <span>${orderTotal.toFixed(2)}</span>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/order-confirmation.tsx",
      "content": "\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport { CheckCircle2, XCircle, Loader2, Package } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useCartStore } from \"@/components/zustand-cart\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\n\ninterface OrderDetails {\n  id: string;\n  status: string;\n  paymentStatus: string;\n  totalAmount: number;\n  shippingAddress: {\n    fullName: string;\n    addressLine1: string;\n    addressLine2?: string;\n    city: string;\n    state: string;\n    postalCode: string;\n    country: string;\n  } | null;\n  items: {\n    id: string;\n    quantity: number;\n    price: number;\n    product: {\n      name: string;\n      image: string;\n    };\n  }[];\n  createdAt: string;\n}\n\nexport function OrderConfirmation() {\n  const searchParams = useSearchParams();\n  const [orderDetails, setOrderDetails] = useState<OrderDetails | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>(\"\");\n  const clearCart = useCartStore((state) => state.clearCart);\n\n  const paymentIntentId = searchParams.get(\"payment_intent\");\n  const orderId = searchParams.get(\"order_id\");\n\n  useEffect(() => {\n    const verifyPayment = async () => {\n      if (!paymentIntentId || !orderId) {\n        setError(\"Missing payment information.\");\n        setLoading(false);\n        return;\n      }\n\n      try {\n        const response = await fetch(\"/api/stripe/verify-payment\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ paymentIntentId, orderId }),\n        });\n\n        const data = await response.json();\n\n        if (!response.ok) {\n          throw new Error(data.error || \"Failed to verify payment\");\n        }\n\n        setOrderDetails(data.order);\n\n        // Clear cart on successful payment\n        if (data.order.paymentStatus === \"paid\") {\n          clearCart();\n        }\n      } catch (err) {\n        setError(\n          err instanceof Error ? err.message : \"Failed to verify payment\"\n        );\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    verifyPayment();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [paymentIntentId, orderId]);\n\n  if (loading) {\n    return (\n      <div className=\"flex min-h-[60vh] flex-col items-center justify-center gap-4\">\n        <Loader2 className=\"h-12 w-12 animate-spin text-indigo-600\" />\n        <p className=\"text-lg text-muted-foreground\">\n          Verifying your payment...\n        </p>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex min-h-[60vh] flex-col items-center justify-center gap-4\">\n        <XCircle className=\"h-16 w-16 text-destructive\" />\n        <h2 className=\"text-2xl font-semibold\">Something went wrong</h2>\n        <p className=\"text-muted-foreground\">{error}</p>\n        <Button asChild>\n          <Link href=\"/products\">Back to Products</Link>\n        </Button>\n      </div>\n    );\n  }\n\n  if (!orderDetails) return null;\n\n  const isPaid = orderDetails.paymentStatus === \"paid\";\n\n  return (\n    <div className=\"mx-auto max-w-3xl px-4 py-12\">\n      <div className=\"text-center\">\n        {isPaid ? (\n          <CheckCircle2 className=\"mx-auto h-16 w-16 text-green-500\" />\n        ) : (\n          <XCircle className=\"mx-auto h-16 w-16 text-yellow-500\" />\n        )}\n\n        <h1 className=\"mt-4 text-3xl font-bold\">\n          {isPaid ? \"Payment Successful!\" : \"Payment Pending\"}\n        </h1>\n        <p className=\"mt-2 text-muted-foreground\">\n          {isPaid\n            ? \"Thank you for your purchase. Your order has been confirmed.\"\n            : \"Your payment is being processed. We'll update you shortly.\"}\n        </p>\n        <p className=\"mt-1 text-sm text-muted-foreground\">\n          Order ID: {orderDetails.id}\n        </p>\n      </div>\n\n      {/* Order Items */}\n      <div className=\"mt-8 rounded-lg border bg-card p-6\">\n        <h3 className=\"mb-4 flex items-center gap-2 text-lg font-semibold\">\n          <Package className=\"h-5 w-5\" />\n          Order Items\n        </h3>\n        <div className=\"space-y-3\">\n          {orderDetails.items.map((item) => (\n            <div key={item.id} className=\"flex items-center gap-3\">\n              <div className=\"relative h-12 w-12 flex-shrink-0 overflow-hidden rounded-md\">\n                <Image\n                  src={item.product.image}\n                  alt={item.product.name}\n                  fill\n                  className=\"object-cover\"\n                  sizes=\"48px\"\n                />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium\">{item.product.name}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  Qty: {item.quantity}\n                </p>\n              </div>\n              <p className=\"text-sm font-medium\">\n                ${(item.price * item.quantity).toFixed(2)}\n              </p>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"mt-4 border-t pt-4\">\n          <div className=\"flex justify-between font-semibold\">\n            <span>Total</span>\n            <span>${orderDetails.totalAmount.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Shipping Address */}\n      {orderDetails.shippingAddress && (\n        <div className=\"mt-6 rounded-lg border bg-card p-6\">\n          <h3 className=\"mb-2 text-lg font-semibold\">Shipping Address</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            {orderDetails.shippingAddress.fullName}\n          </p>\n          <p className=\"text-sm text-muted-foreground\">\n            {orderDetails.shippingAddress.addressLine1}\n          </p>\n          {orderDetails.shippingAddress.addressLine2 && (\n            <p className=\"text-sm text-muted-foreground\">\n              {orderDetails.shippingAddress.addressLine2}\n            </p>\n          )}\n          <p className=\"text-sm text-muted-foreground\">\n            {orderDetails.shippingAddress.city},{\" \"}\n            {orderDetails.shippingAddress.state}{\" \"}\n            {orderDetails.shippingAddress.postalCode}\n          </p>\n          <p className=\"text-sm text-muted-foreground\">\n            {orderDetails.shippingAddress.country}\n          </p>\n        </div>\n      )}\n\n      <div className=\"mt-8 flex justify-center gap-4\">\n        <Button asChild variant=\"outline\">\n          <Link href=\"/dashboard/orders\">View My Orders</Link>\n        </Button>\n        <Button asChild>\n          <Link href=\"/products\">Continue Shopping</Link>\n        </Button>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/order-history.tsx",
      "content": "\"use client\";\n\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Package, Eye } from \"lucide-react\";\nimport Link from \"next/link\";\n\ninterface OrderHistoryItem {\n  id: string;\n  status: string;\n  paymentStatus: string;\n  totalAmount: number;\n  createdAt: string;\n  _count: {\n    items: number;\n  };\n}\n\ninterface OrderHistoryProps {\n  orders: OrderHistoryItem[];\n}\n\nfunction getStatusVariant(\n  status: string\n): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  switch (status) {\n    case \"completed\":\n      return \"default\";\n    case \"processing\":\n      return \"secondary\";\n    case \"cancelled\":\n      return \"destructive\";\n    default:\n      return \"outline\";\n  }\n}\n\nfunction getPaymentVariant(\n  status: string\n): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  switch (status) {\n    case \"paid\":\n      return \"default\";\n    case \"refunded\":\n      return \"secondary\";\n    case \"failed\":\n      return \"destructive\";\n    default:\n      return \"outline\";\n  }\n}\n\nexport function OrderHistory({ orders }: OrderHistoryProps) {\n  if (orders.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n        <Package className=\"mb-4 h-12 w-12 text-muted-foreground\" />\n        <h3 className=\"text-lg font-semibold\">No orders yet</h3>\n        <p className=\"mb-4 text-sm text-muted-foreground\">\n          Start shopping to see your orders here.\n        </p>\n        <Button asChild>\n          <Link href=\"/products\">Browse Products</Link>\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"rounded-lg border\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead>Order ID</TableHead>\n            <TableHead>Date</TableHead>\n            <TableHead>Items</TableHead>\n            <TableHead>Total</TableHead>\n            <TableHead>Status</TableHead>\n            <TableHead>Payment</TableHead>\n            <TableHead className=\"text-right\">Actions</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {orders.map((order) => (\n            <TableRow key={order.id}>\n              <TableCell className=\"font-mono text-xs\">\n                {order.id.slice(0, 8)}...\n              </TableCell>\n              <TableCell className=\"text-sm\">\n                {new Date(order.createdAt).toLocaleDateString()}\n              </TableCell>\n              <TableCell>{order._count.items} items</TableCell>\n              <TableCell className=\"font-medium\">\n                ${order.totalAmount.toFixed(2)}\n              </TableCell>\n              <TableCell>\n                <Badge variant={getStatusVariant(order.status)}>\n                  {order.status}\n                </Badge>\n              </TableCell>\n              <TableCell>\n                <Badge variant={getPaymentVariant(order.paymentStatus)}>\n                  {order.paymentStatus}\n                </Badge>\n              </TableCell>\n              <TableCell className=\"text-right\">\n                <Button variant=\"ghost\" size=\"sm\" asChild>\n                  <Link href={`/dashboard/orders/${order.id}`}>\n                    <Eye className=\"mr-1 h-4 w-4\" />\n                    View\n                  </Link>\n                </Button>\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/product-grid.tsx",
      "content": "\"use client\";\n\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { ShoppingCart, Heart } from \"lucide-react\";\nimport { useCartStore } from \"@/components/zustand-cart\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface Product {\n  id: string;\n  name: string;\n  description: string;\n  price: number;\n  image: string;\n  categoryId?: string;\n}\n\ninterface ProductGridProps {\n  products: Product[];\n}\n\nexport function ProductGrid({ products }: ProductGridProps) {\n  const addToCart = useCartStore((state) => state.addToCart);\n\n  if (products.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n        <ShoppingCart className=\"mb-4 h-12 w-12 text-muted-foreground\" />\n        <h3 className=\"text-lg font-semibold\">No products found</h3>\n        <p className=\"text-sm text-muted-foreground\">\n          Check back later for new products.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4\">\n        {products.map((product) => (\n          <div\n            key={product.id}\n            className=\"group overflow-hidden rounded-lg border bg-card shadow-sm transition-all duration-300 hover:shadow-lg\"\n          >\n            <div className=\"relative h-48 overflow-hidden\">\n              <Image\n                src={product.image}\n                alt={product.name}\n                fill\n                className=\"object-cover transition-transform duration-300 group-hover:scale-105\"\n                sizes=\"(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw\"\n              />\n              <div className=\"absolute top-3 right-3 opacity-0 transition-opacity duration-300 group-hover:opacity-100\">\n                <button className=\"rounded-full bg-white p-2 shadow-md transition-colors hover:bg-gray-50\">\n                  <Heart className=\"h-4 w-4 text-gray-600\" />\n                </button>\n              </div>\n            </div>\n\n            <div className=\"p-4\">\n              <h3 className=\"mb-1 line-clamp-1 text-sm font-semibold transition-colors group-hover:text-indigo-600\">\n                {product.name}\n              </h3>\n              <p className=\"mb-3 line-clamp-2 text-xs text-muted-foreground\">\n                {product.description}\n              </p>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-lg font-bold text-green-600\">\n                  ${product.price.toFixed(2)}\n                </span>\n                <Button\n                  size=\"sm\"\n                  className=\"flex items-center gap-1\"\n                  onClick={() => addToCart(product)}\n                >\n                  <ShoppingCart className=\"h-3.5 w-3.5\" />\n                  Add\n                </Button>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Floating Cart Button */}\n      <FloatingCart />\n    </>\n  );\n}\n\nfunction FloatingCart() {\n  const { items, getCartTotalItems, getCartTotalPrice } = useCartStore();\n  const totalItems = getCartTotalItems();\n  const totalPrice = getCartTotalPrice();\n\n  if (totalItems === 0) return null;\n\n  return (\n    <div className=\"fixed bottom-6 right-6 z-50\">\n      <Link href=\"/checkout\">\n        <Button\n          size=\"lg\"\n          className=\"flex items-center gap-3 bg-indigo-600 shadow-lg hover:bg-indigo-700\"\n        >\n          <ShoppingCart className=\"h-5 w-5\" />\n          <span>\n            {totalItems} {totalItems === 1 ? \"item\" : \"items\"}\n          </span>\n          <span className=\"border-l border-white/30 pl-3\">\n            ${totalPrice.toFixed(2)}\n          </span>\n        </Button>\n      </Link>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/stripe/index.ts",
      "content": "export { StripeProvider } from \"./stripe-provider\";\nexport { CheckoutForm } from \"./checkout-form\";\nexport { CheckoutPage } from \"./checkout-page\";\nexport { AddressForm } from \"./address-form\";\nexport type { ShippingAddress } from \"./address-form\";\nexport { OrderSummary } from \"./order-summary\";\nexport { OrderConfirmation } from \"./order-confirmation\";\nexport { OrderHistory } from \"./order-history\";\nexport { ProductGrid } from \"./product-grid\";\n",
      "type": "registry:component"
    },
    {
      "path": "lib/stripe.ts",
      "content": "import Stripe from \"stripe\";\n\nexport const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\n  typescript: true,\n});\n",
      "type": "registry:lib"
    },
    {
      "path": "app/api/stripe/create-payment-intent/route.ts",
      "content": "import { NextResponse } from \"next/server\";\nimport { stripe } from \"@/lib/stripe\";\nimport { auth } from \"@/lib/auth\";\nimport db from \"@/lib/prisma\";\nimport { headers } from \"next/headers\";\n\ninterface CartItem {\n  productId: string;\n  quantity: number;\n  price: number;\n  name: string;\n  image: string;\n}\n\ninterface ShippingAddress {\n  fullName: string;\n  addressLine1: string;\n  addressLine2?: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n}\n\nexport async function POST(req: Request) {\n  try {\n    // Authenticate user\n    const session = await auth.api.getSession({\n      headers: await headers(),\n    });\n\n    if (!session) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const body = await req.json();\n    const {\n      items,\n      shippingAddress,\n      deliveryFee = 0,\n      tax = 0,\n    }: {\n      items: CartItem[];\n      shippingAddress: ShippingAddress;\n      deliveryFee: number;\n      tax: number;\n    } = body;\n\n    if (!items || items.length === 0) {\n      return NextResponse.json(\n        { error: \"Cart is empty\" },\n        { status: 400 }\n      );\n    }\n\n    // Verify products exist in our database and get current prices\n    const productIds = items.map((item) => item.productId);\n    const products = await db.product.findMany({\n      where: { id: { in: productIds } },\n    });\n\n    if (products.length !== productIds.length) {\n      const foundIds = products.map((p) => p.id);\n      const missingIds = productIds.filter((id) => !foundIds.includes(id));\n      return NextResponse.json(\n        {\n          error:\n            \"Some products not found. Your cart may contain outdated items. Please clear your cart and add products from the products page.\",\n          missingIds,\n        },\n        { status: 400 }\n      );\n    }\n\n    // Ensure products exist in Stripe, create if not\n    for (const product of products) {\n      if (!product.stripeProductId || !product.stripePriceId) {\n        const stripeProduct = await stripe.products.create({\n          name: product.name,\n          description: product.description || undefined,\n          images: product.image ? [product.image] : undefined,\n        });\n\n        const stripePrice = await stripe.prices.create({\n          product: stripeProduct.id,\n          unit_amount: Math.round(product.price * 100),\n          currency: \"usd\",\n        });\n\n        await db.product.update({\n          where: { id: product.id },\n          data: {\n            stripeProductId: stripeProduct.id,\n            stripePriceId: stripePrice.id,\n          },\n        });\n      }\n    }\n\n    // Calculate total using DB prices (not client prices) for security\n    const subtotal = items.reduce((total, item) => {\n      const product = products.find((p) => p.id === item.productId);\n      return total + (product?.price || 0) * item.quantity;\n    }, 0);\n\n    const totalAmount = subtotal + deliveryFee + tax;\n    const amountInCents = Math.round(totalAmount * 100);\n\n    // Create order in database\n    const order = await db.order.create({\n      data: {\n        userId: session.user.id,\n        status: \"pending\",\n        paymentStatus: \"unpaid\",\n        totalAmount,\n        shippingAddress: JSON.stringify(shippingAddress),\n        items: {\n          create: items.map((item) => {\n            const product = products.find((p) => p.id === item.productId);\n            return {\n              productId: item.productId,\n              quantity: item.quantity,\n              price: product?.price || item.price,\n            };\n          }),\n        },\n      },\n    });\n\n    // Create Stripe PaymentIntent\n    const paymentIntent = await stripe.paymentIntents.create({\n      amount: amountInCents,\n      currency: \"usd\",\n      automatic_payment_methods: { enabled: true },\n      metadata: {\n        orderId: order.id,\n        userId: session.user.id,\n      },\n    });\n\n    // Update order with payment intent ID\n    await db.order.update({\n      where: { id: order.id },\n      data: { paymentIntentId: paymentIntent.id },\n    });\n\n    return NextResponse.json({\n      clientSecret: paymentIntent.client_secret,\n      orderId: order.id,\n    });\n  } catch (error) {\n    console.error(\"Create payment intent error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to create payment intent\" },\n      { status: 500 }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/stripe/create-payment-intent/route.ts"
    },
    {
      "path": "app/api/stripe/verify-payment/route.ts",
      "content": "import { NextResponse } from \"next/server\";\nimport { stripe } from \"@/lib/stripe\";\nimport { auth } from \"@/lib/auth\";\nimport db from \"@/lib/prisma\";\nimport { headers } from \"next/headers\";\n\nexport async function POST(req: Request) {\n  try {\n    // Authenticate user\n    const session = await auth.api.getSession({\n      headers: await headers(),\n    });\n\n    if (!session) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const { paymentIntentId, orderId } = await req.json();\n\n    if (!paymentIntentId || !orderId) {\n      return NextResponse.json(\n        { error: \"Missing payment intent ID or order ID\" },\n        { status: 400 }\n      );\n    }\n\n    // Retrieve payment intent from Stripe\n    const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\n\n    // Find the order and verify it belongs to the user\n    const order = await db.order.findUnique({\n      where: { id: orderId },\n      include: {\n        items: {\n          include: {\n            product: {\n              select: {\n                name: true,\n                image: true,\n              },\n            },\n          },\n        },\n      },\n    });\n\n    if (!order) {\n      return NextResponse.json(\n        { error: \"Order not found\" },\n        { status: 404 }\n      );\n    }\n\n    if (order.userId !== session.user.id) {\n      return NextResponse.json(\n        { error: \"Unauthorized\" },\n        { status: 403 }\n      );\n    }\n\n    // Update order based on payment status\n    if (paymentIntent.status === \"succeeded\" && order.paymentStatus !== \"paid\") {\n      await db.order.update({\n        where: { id: orderId },\n        data: {\n          paymentStatus: \"paid\",\n          status: \"completed\",\n        },\n      });\n\n      return NextResponse.json({\n        order: {\n          ...order,\n          paymentStatus: \"paid\",\n          status: \"completed\",\n          shippingAddress: order.shippingAddress\n            ? JSON.parse(order.shippingAddress)\n            : null,\n        },\n      });\n    }\n\n    return NextResponse.json({\n      order: {\n        ...order,\n        shippingAddress: order.shippingAddress\n          ? JSON.parse(order.shippingAddress)\n          : null,\n      },\n    });\n  } catch (error) {\n    console.error(\"Verify payment error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to verify payment\" },\n      { status: 500 }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/stripe/verify-payment/route.ts"
    },
    {
      "path": "app/products/page.tsx",
      "content": "import db from \"@/lib/prisma\";\nimport { ProductGrid } from \"@/components/stripe/product-grid\";\nimport Link from \"next/link\";\n\nexport default async function ProductsPage() {\n  const products = await db.product.findMany({\n    include: {\n      category: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  const categories = await db.category.findMany({\n    orderBy: { name: \"asc\" },\n  });\n\n  return (\n    <div className=\"mx-auto max-w-7xl px-4 py-8\">\n      <div className=\"mb-8 flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Products</h1>\n          <p className=\"mt-1 text-muted-foreground\">\n            Browse our collection and add items to your cart\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Link\n            href=\"/dashboard\"\n            className=\"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90\"\n          >\n            Dashboard\n          </Link>\n        </div>\n      </div>\n\n      {/* Category filters */}\n      <div className=\"mb-6 flex gap-2\">\n        <Link\n          href=\"/products\"\n          className=\"rounded-full border px-4 py-1.5 text-sm font-medium transition-colors hover:bg-accent\"\n        >\n          All\n        </Link>\n        {categories.map((cat) => (\n          <Link\n            key={cat.id}\n            href={`/products?category=${cat.slug}`}\n            className=\"rounded-full border px-4 py-1.5 text-sm font-medium transition-colors hover:bg-accent\"\n          >\n            {cat.name}\n          </Link>\n        ))}\n      </div>\n\n      <ProductGrid\n        products={products.map((p) => ({\n          id: p.id,\n          name: p.name,\n          description: p.description || \"\",\n          price: p.price,\n          image: p.image,\n          categoryId: p.categoryId || undefined,\n        }))}\n      />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/products/page.tsx"
    },
    {
      "path": "app/checkout/page.tsx",
      "content": "import { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { redirect } from \"next/navigation\";\nimport { CheckoutPage } from \"@/components/stripe/checkout-page\";\n\nexport default async function Checkout() {\n  const session = await auth.api.getSession({\n    headers: await headers(),\n  });\n\n  if (!session) {\n    redirect(\"/auth/sign-in\");\n  }\n\n  return <CheckoutPage />;\n}\n",
      "type": "registry:page",
      "target": "app/checkout/page.tsx"
    },
    {
      "path": "app/order-confirmation/page.tsx",
      "content": "import { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { redirect } from \"next/navigation\";\nimport { OrderConfirmation } from \"@/components/stripe/order-confirmation\";\nimport { Suspense } from \"react\";\n\nexport default async function OrderConfirmationPage() {\n  const session = await auth.api.getSession({\n    headers: await headers(),\n  });\n\n  if (!session) {\n    redirect(\"/auth/sign-in\");\n  }\n\n  return (\n    <Suspense fallback={<div className=\"flex min-h-[60vh] items-center justify-center\">Loading...</div>}>\n      <OrderConfirmation />\n    </Suspense>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/order-confirmation/page.tsx"
    },
    {
      "path": "app/dashboard/orders/page.tsx",
      "content": "import { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { redirect } from \"next/navigation\";\nimport db from \"@/lib/prisma\";\nimport { OrderHistory } from \"@/components/stripe/order-history\";\n\nexport default async function OrdersPage() {\n  const session = await auth.api.getSession({\n    headers: await headers(),\n  });\n\n  if (!session) {\n    redirect(\"/auth/sign-in\");\n  }\n\n  const orders = await db.order.findMany({\n    where: {\n      userId: session.user.id,\n    },\n    include: {\n      _count: {\n        select: { items: true },\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold\">My Orders</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          View and track your order history\n        </p>\n      </div>\n\n      <OrderHistory\n        orders={orders.map((order) => ({\n          ...order,\n          createdAt: order.createdAt.toISOString(),\n        }))}\n      />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/dashboard/orders/page.tsx"
    },
    {
      "path": "app/dashboard/orders/[id]/page.tsx",
      "content": "import { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { redirect, notFound } from \"next/navigation\";\nimport db from \"@/lib/prisma\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, Package } from \"lucide-react\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\n\nexport default async function OrderDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>;\n}) {\n  const session = await auth.api.getSession({\n    headers: await headers(),\n  });\n\n  if (!session) {\n    redirect(\"/auth/sign-in\");\n  }\n\n  const { id } = await params;\n\n  const order = await db.order.findUnique({\n    where: { id },\n    include: {\n      items: {\n        include: {\n          product: true,\n        },\n      },\n    },\n  });\n\n  if (!order || order.userId !== session.user.id) {\n    notFound();\n  }\n\n  const shippingAddress = order.shippingAddress\n    ? JSON.parse(order.shippingAddress)\n    : null;\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-6\">\n        <Button variant=\"ghost\" asChild className=\"mb-4\">\n          <Link href=\"/dashboard/orders\">\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            Back to Orders\n          </Link>\n        </Button>\n\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">Order Details</h1>\n            <p className=\"text-sm text-muted-foreground\">\n              Order ID: {order.id}\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Badge\n              variant={\n                order.status === \"completed\"\n                  ? \"default\"\n                  : order.status === \"cancelled\"\n                    ? \"destructive\"\n                    : \"outline\"\n              }\n            >\n              {order.status}\n            </Badge>\n            <Badge\n              variant={\n                order.paymentStatus === \"paid\"\n                  ? \"default\"\n                  : order.paymentStatus === \"failed\"\n                    ? \"destructive\"\n                    : \"outline\"\n              }\n            >\n              {order.paymentStatus}\n            </Badge>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-[1fr_350px]\">\n        {/* Order Items */}\n        <div className=\"rounded-lg border bg-card p-6\">\n          <h3 className=\"mb-4 flex items-center gap-2 text-lg font-semibold\">\n            <Package className=\"h-5 w-5\" />\n            Items ({order.items.length})\n          </h3>\n          <div className=\"space-y-4\">\n            {order.items.map((item) => (\n              <div\n                key={item.id}\n                className=\"flex items-center gap-4 border-b pb-4 last:border-0 last:pb-0\"\n              >\n                <div className=\"relative h-16 w-16 flex-shrink-0 overflow-hidden rounded-md\">\n                  <Image\n                    src={item.product.image}\n                    alt={item.product.name}\n                    fill\n                    className=\"object-cover\"\n                    sizes=\"64px\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"font-medium\">{item.product.name}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Qty: {item.quantity} x ${item.price.toFixed(2)}\n                  </p>\n                </div>\n                <p className=\"font-semibold\">\n                  ${(item.price * item.quantity).toFixed(2)}\n                </p>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Summary + Address */}\n        <div className=\"space-y-6\">\n          <div className=\"rounded-lg border bg-card p-6\">\n            <h3 className=\"mb-3 text-lg font-semibold\">Summary</h3>\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Date</span>\n                <span className=\"text-sm\">\n                  {order.createdAt.toLocaleDateString()}\n                </span>\n              </div>\n              <div className=\"flex justify-between border-t pt-2 font-semibold\">\n                <span>Total</span>\n                <span>${order.totalAmount.toFixed(2)}</span>\n              </div>\n            </div>\n          </div>\n\n          {shippingAddress && (\n            <div className=\"rounded-lg border bg-card p-6\">\n              <h3 className=\"mb-3 text-lg font-semibold\">Shipping Address</h3>\n              <div className=\"text-sm text-muted-foreground\">\n                <p className=\"font-medium text-foreground\">\n                  {shippingAddress.fullName}\n                </p>\n                <p>{shippingAddress.addressLine1}</p>\n                {shippingAddress.addressLine2 && (\n                  <p>{shippingAddress.addressLine2}</p>\n                )}\n                <p>\n                  {shippingAddress.city}, {shippingAddress.state}{\" \"}\n                  {shippingAddress.postalCode}\n                </p>\n                <p>{shippingAddress.country}</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/dashboard/orders/[id]/page.tsx"
    }
  ],
  "envVars": {
    "STRIPE_SECRET_KEY": "",
    "NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY": ""
  },
  "type": "registry:block"
}